<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Workflow V3 - Prometrix</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.10.2/cdn.min.js" defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        :root {
            --primary: #5046e5;
            --primary-dark: #4039c0;
            --secondary: #00c4cc;
        }

        /* Prometrix Logo Styles */
        .prometrix-wordmark {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }

        .gradient-text {
            background: linear-gradient(135deg, #5046e5 0%, #00c4cc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .primary-text {
            color: #5046e5;
        }

        .dark-text {
            color: #1a202c;
        }

        .analytics-bars {
            display: flex;
            align-items: end;
            gap: 2px;
            margin-left: 8px;
            margin-right: 4px;
        }

        .bar {
            border-radius: 2px;
            background: linear-gradient(135deg, #00c4cc 0%, #5046e5 100%);
            width: 3px;
        }

        .bar1 {
            height: 10px;
            opacity: 0.7;
        }

        .bar2 {
            height: 14px;
            opacity: 0.8;
        }

        .bar3 {
            height: 18px;
            opacity: 0.9;
        }

        .bar4 {
            height: 22px;
        }

        .tagline-small {
            font-size: 9px;
            font-weight: 600;
            letter-spacing: 1px;
            color: #718096;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
            min-height: 100vh;
            display: flex;
        }

        .sidebar {
            width: 280px;
            background-color: white;
            height: 100vh;
            position: fixed;
            border-right: 1px solid #e2e8f0;
            padding: 1.5rem 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .menu-item {
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #718096;
            font-weight: 500;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .menu-item:hover {
            background-color: rgba(80, 70, 229, 0.05);
            color: var(--primary);
        }

        .menu-item.active {
            color: var(--primary);
            background-color: rgba(80, 70, 229, 0.1);
            border-left-color: var(--primary);
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background-color: white;
            color: var(--primary);
            border: 1px solid #e2e8f0;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background-color: rgba(80, 70, 229, 0.05);
            border-color: var(--primary);
        }

        .card {
            background: white;
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            margin-bottom: 1.5rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            font-family: inherit;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(80, 70, 229, 0.1);
        }

        .post-type-card {
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            overflow: hidden;
            transition: all 0.3s;
            background: white;
            cursor: pointer;
        }

        .post-type-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .post-type-card.active {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(80, 70, 229, 0.2);
        }

        .post-item {
            background: #f0f4ff;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            margin-top: 0.25rem;
            transition: all 0.2s;
        }

        .post-item:hover {
            background: #e0e7ff;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-primary {
            background: #ede9fe;
            color: #5b21b6;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .tab {
            padding: 0.75rem 1rem;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: #6b7280;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .section-divider {
            border-top: 2px solid #e5e7eb;
            margin: 2rem 0;
            padding-top: 2rem;
        }
    </style>
</head>

<body x-data="workflowApp()">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div style="padding: 0 1.5rem 1.5rem; border-bottom: 1px solid #e2e8f0;">
            <div style="text-align: left;">
                <div class="prometrix-wordmark">
                    <span class="dark-text">Pro</span>
                    <span class="primary-text">me</span>
                    <span class="gradient-text">t</span>
                    <div class="analytics-bars">
                        <div class="bar bar1"></div>
                        <div class="bar bar2"></div>
                        <div class="bar bar3"></div>
                        <div class="bar bar4"></div>
                    </div>
                    <span class="gradient-text">rix</span>
                </div>
                <div class="tagline-small">AI-POWERED MARKETING</div>
            </div>
        </div>
        <nav style="margin-top: 1.5rem; overflow-y: auto; max-height: calc(100vh - 100px);">
            <ul style="list-style: none;">
                <!-- Create Campaign -->
                <li>
                    <a class="menu-item active" href="FACEBOOK-CREATE-CAMPAIGN.html" style="text-decoration: none;">
                        <span>üöÄ</span>
                        <span>Create Campaign</span>
                    </a>
                </li>

                <!-- Brand Registration -->
                <li>
                    <a class="menu-item" href="FACEBOOK-BRAND-REGISTRATION.html" style="text-decoration: none;">
                        <span>üè¢</span>
                        <span>Brand Registration</span>
                    </a>
                </li>

                <!-- Inspire Me -->
                <li>
                    <a class="menu-item" href="FACEBOOK-INSPIRE-ME.html" style="text-decoration: none;">
                        <span>üí°</span>
                        <span>Inspire Me</span>
                    </a>
                </li>

                <!-- Engage Boost with Submenu -->
                <li x-data="{ engageOpen: false }">
                    <a class="menu-item" href="FACEBOOK-ENGAGE-BOOST.html"
                        style="text-decoration: none; justify-content: space-between;">
                        <span style="display: flex; align-items: center; gap: 0.75rem;">
                            <span>üí¨</span>
                            <span>Engage Boost</span>
                        </span>
                        <span x-text="engageOpen ? '‚ñº' : '‚ñ∂'" style="font-size: 0.7rem;"></span>
                    </a>
                    <ul x-show="engageOpen" x-transition
                        style="list-style: none; background: #f8fafc; margin: 0; padding: 0;">
                        <li>
                            <a class="menu-item" href="FACEBOOK-ENGAGE-BOOST.html#pending"
                                style="padding-left: 3rem; font-size: 0.9rem; text-decoration: none;">
                                <span>‚è≥</span>
                                <span>Pending Reviews</span>
                            </a>
                        </li>
                        <li>
                            <a class="menu-item" href="FACEBOOK-ENGAGE-BOOST.html#all"
                                style="padding-left: 3rem; font-size: 0.9rem; text-decoration: none;">
                                <span>üí≠</span>
                                <span>All Comments</span>
                            </a>
                        </li>
                        <li>
                            <a class="menu-item" href="FACEBOOK-ENGAGE-BOOST.html#approved"
                                style="padding-left: 3rem; font-size: 0.9rem; text-decoration: none;">
                                <span>‚úÖ</span>
                                <span>Approved</span>
                            </a>
                        </li>
                        <li>
                            <a class="menu-item" href="FACEBOOK-ENGAGE-BOOST.html#rejected"
                                style="padding-left: 3rem; font-size: 0.9rem; text-decoration: none;">
                                <span>‚ùå</span>
                                <span>Rejected</span>
                            </a>
                        </li>
                        <li>
                            <a class="menu-item" href="FACEBOOK-ENGAGE-BOOST.html#knowledge"
                                style="padding-left: 3rem; font-size: 0.9rem; text-decoration: none;">
                                <span>üìö</span>
                                <span>Knowledge Base</span>
                            </a>
                        </li>
                        <li>
                            <a class="menu-item" href="FACEBOOK-ENGAGE-BOOST.html#analytics"
                                style="padding-left: 3rem; font-size: 0.9rem; text-decoration: none;">
                                <span>üìä</span>
                                <span>Analytics</span>
                            </a>
                        </li>
                        <li>
                            <a class="menu-item" href="FACEBOOK-ENGAGE-BOOST.html#settings"
                                style="padding-left: 3rem; font-size: 0.9rem; text-decoration: none;">
                                <span>‚öôÔ∏è</span>
                                <span>Settings</span>
                            </a>
                        </li>
                    </ul>
                </li>

                <!-- Insights -->
                <li>
                    <a class="menu-item" href="#" style="text-decoration: none;">
                        <span>üìà</span>
                        <span>Insights</span>
                    </a>
                </li>

                <!-- Settings with Submenu -->
                <li x-data="{ settingsOpen: false }">
                    <a class="menu-item" href="FACEBOOK-SETTINGS.html"
                        style="text-decoration: none; justify-content: space-between;">
                        <span style="display: flex; align-items: center; gap: 0.75rem;">
                            <span>‚öôÔ∏è</span>
                            <span>Settings</span>
                        </span>
                        <span x-text="settingsOpen ? '‚ñº' : '‚ñ∂'" style="font-size: 0.7rem;"></span>
                    </a>
                    <ul x-show="settingsOpen" x-transition
                        style="list-style: none; background: #f8fafc; margin: 0; padding: 0;">
                        <li>
                            <a class="menu-item" href="FACEBOOK-SETTINGS.html#language"
                                style="padding-left: 3rem; font-size: 0.9rem; text-decoration: none;">
                                <span>üåê</span>
                                <span>Language</span>
                            </a>
                        </li>
                        <li>
                            <a class="menu-item" href="FACEBOOK-SETTINGS.html#llm"
                                style="padding-left: 3rem; font-size: 0.9rem; text-decoration: none;">
                                <span>ü§ñ</span>
                                <span>LLM Settings</span>
                            </a>
                        </li>
                        <li>
                            <a class="menu-item" href="FACEBOOK-SETTINGS.html#guardrails"
                                style="padding-left: 3rem; font-size: 0.9rem; text-decoration: none;">
                                <span>üõ°Ô∏è</span>
                                <span>Guardrails</span>
                            </a>
                        </li>
                        <li>
                            <a class="menu-item" href="FACEBOOK-SETTINGS.html#integrations"
                                style="padding-left: 3rem; font-size: 0.9rem; text-decoration: none;">
                                <span>üîó</span>
                                <span>Integrations</span>
                            </a>
                        </li>
                        <li>
                            <a class="menu-item" href="FACEBOOK-SETTINGS.html#products"
                                style="padding-left: 3rem; font-size: 0.9rem; text-decoration: none;">
                                <span>üì¶</span>
                                <span>Products</span>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Campaign Workflow -->
        <div x-show="activeView === 'workflow'">
            <h1 style="font-size: 1.875rem; font-weight: 700; margin-bottom: 0.5rem;">Campaign Workflow</h1>
            <p style="color: #718096; margin-bottom: 2rem;">Create and manage your social media campaigns</p>

            <!-- Step 1: Campaign Setup (REORDERED) -->
            <div x-show="workflow.currentStep === 1" class="card">
                <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">Step 1: Campaign Setup</h2>

                <!-- 1. Campaign Basics (FIRST) -->
                <div>
                    <h3 style="font-weight: 600; font-size: 1.125rem; margin-bottom: 1rem; color: var(--primary);">
                        Campaign Basics</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                        <div>
                            <label style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Campaign
                                Name</label>
                            <input type="text" x-model="workflow.name" class="form-control"
                                placeholder="e.g., Summer Product Launch">
                        </div>

                        <div>
                            <label style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Campaign
                                Objective</label>
                            <select x-model="workflow.objective" class="form-control">
                                <option value="awareness">Brand Awareness</option>
                                <option value="engagement">Engagement</option>
                                <option value="leads">Lead Generation</option>
                                <option value="traffic">Website Traffic</option>
                                <option value="sales">Sales</option>
                            </select>
                        </div>

                        <div style="grid-column: span 2;">
                            <label style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Target
                                Audience</label>
                            <textarea x-model="workflow.audience" class="form-control" rows="3"
                                placeholder="Describe your target audience..."></textarea>
                        </div>

                        <div>
                            <label style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Start Date</label>
                            <input type="date" x-model="workflow.startDate" class="form-control">
                        </div>
                        <div>
                            <label style="display: block; font-weight: 500; margin-bottom: 0.5rem;">End Date</label>
                            <input type="date" x-model="workflow.endDate" class="form-control">
                        </div>

                        <div style="grid-column: span 2;">
                            <label style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Frequency</label>
                            <select x-model="workflow.frequency" class="form-control">
                                <option value="1">Daily</option>
                                <option value="2">Every 2 days</option>
                                <option value="3">3 times per week</option>
                                <option value="7">Weekly</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 2. Personas -->
                <div class="section-divider">
                    <h3 style="font-weight: 600; font-size: 1.125rem; margin-bottom: 1rem; color: var(--primary);">
                        Personas</h3>
                    <label style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Select Personas</label>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <template x-for="persona in personas" :key="persona.id">
                            <label
                                style="display: flex; align-items: center; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s;"
                                :style="workflow.selectedPersonaIds.includes(persona.id) ? 'background: rgba(80, 70, 229, 0.05); border-color: var(--primary);' : ''">
                                <input type="checkbox" :checked="workflow.selectedPersonaIds.includes(persona.id)"
                                    @change="togglePersona(persona.id)" style="margin-right: 0.75rem; cursor: pointer;">
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; font-size: 0.9rem;" x-text="persona.name"></div>
                                    <div style="font-size: 0.75rem; color: #718096; margin-top: 0.125rem;"
                                        x-text="persona.summary"></div>
                                </div>
                                <span class="badge" :class="persona.type === 'AI' ? 'badge-primary' : 'badge-success'"
                                    x-text="persona.type"></span>
                            </label>
                        </template>
                    </div>
                    <p style="font-size: 0.75rem; color: #718096; margin-top: 0.5rem;">
                        Manage personas in Settings ‚Üí Personas
                    </p>
                </div>

                <!-- 3. Brand -->
                <div class="section-divider">
                    <h3 style="font-weight: 600; font-size: 1.125rem; margin-bottom: 1rem; color: var(--primary);">Brand
                    </h3>
                    <label style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Select Brand</label>
                    <select x-model="workflow.selectedBrandId" class="form-control" @change="loadBrandDefaults()">
                        <option value="">Select a brand...</option>
                        <template x-for="brand in brands" :key="brand.id">
                            <option :value="brand.id" x-text="brand.name"></option>
                        </template>
                    </select>
                    <p style="font-size: 0.75rem; color: #718096; margin-top: 0.25rem;">
                        Manage brands in Settings ‚Üí Brands
                    </p>
                </div>

                <!-- 4. Products -->
                <div class="section-divider">
                    <h3 style="font-weight: 600; font-size: 1.125rem; margin-bottom: 1rem; color: var(--primary);">
                        Products</h3>
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" x-model="workflow.useProducts" style="margin-right: 0.5rem;">
                        <span style="font-weight: 500;">Use products in this campaign</span>
                    </label>

                    <div x-show="workflow.useProducts" style="margin-top: 1rem;">
                        <label style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Select Products</label>
                        <select multiple x-model="workflow.selectedProductIds" class="form-control"
                            style="height: 80px;">
                            <template x-for="product in products" :key="product.id">
                                <option :value="product.id"
                                    x-text="`${product.name} - ${product.sku} (${product.category})`"></option>
                            </template>
                        </select>
                    </div>
                </div>

                <!-- 5. Languages -->
                <div class="section-divider">
                    <h3 style="font-weight: 600; font-size: 1.125rem; margin-bottom: 1rem; color: var(--primary);">
                        Languages</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem;">
                        <div>
                            <label style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Primary
                                Language</label>
                            <select x-model="workflow.primaryLanguage" class="form-control">
                                <option value="en">üá∫üá∏ English</option>
                                <option value="es">üá™üá∏ Spanish</option>
                                <option value="fr">üá´üá∑ French</option>
                                <option value="de">üá©üá™ German</option>
                            </select>
                        </div>
                        <div style="display: flex; align-items: end;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" x-model="workflow.isMultilingual" style="margin-right: 0.5rem;">
                                <span style="font-weight: 500;">Enable Multilingual Posts</span>
                            </label>
                        </div>
                    </div>

                    <div x-show="workflow.isMultilingual" style="margin-top: 1rem;">
                        <label style="display: block; font-weight: 500; margin-bottom: 0.5rem;">Additional
                            Languages</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            <label
                                style="cursor: pointer; padding: 0.5rem 1rem; border: 1px solid #e2e8f0; border-radius: 0.5rem;"
                                :style="workflow.additionalLanguages.includes('es') ? 'background: var(--primary); color: white;' : ''">
                                <input type="checkbox" value="es" x-model="workflow.additionalLanguages"
                                    style="display: none;">
                                üá™üá∏ Spanish
                            </label>
                            <label
                                style="cursor: pointer; padding: 0.5rem 1rem; border: 1px solid #e2e8f0; border-radius: 0.5rem;"
                                :style="workflow.additionalLanguages.includes('fr') ? 'background: var(--primary); color: white;' : ''">
                                <input type="checkbox" value="fr" x-model="workflow.additionalLanguages"
                                    style="display: none;">
                                üá´üá∑ French
                            </label>
                            <label
                                style="cursor: pointer; padding: 0.5rem 1rem; border: 1px solid #e2e8f0; border-radius: 0.5rem;"
                                :style="workflow.additionalLanguages.includes('de') ? 'background: var(--primary); color: white;' : ''">
                                <input type="checkbox" value="de" x-model="workflow.additionalLanguages"
                                    style="display: none;">
                                üá©üá™ German
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 6. Primary Actions -->
                <div class="section-divider">
                    <h3 style="font-weight: 600; font-size: 1.125rem; margin-bottom: 1rem; color: var(--primary);">
                        Primary Actions</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                        <button @click="createCampaignBlueprint()" class="btn-primary"
                            :disabled="!canProceed() || isGenerating">
                            <div x-show="!isGenerating">‚ú® Create Campaign Blueprint</div>
                            <div x-show="isGenerating">‚è≥ Generating with AI...</div>
                            <div style="font-size: 0.75rem; opacity: 0.9; margin-top: 0.25rem;" x-show="!isGenerating">
                                Auto-generate strategy & content</div>
                            <div style="font-size: 0.75rem; opacity: 0.9; margin-top: 0.25rem;" x-show="isGenerating">
                                Connecting to backend...</div>
                        </button>
                        <button @click="goToMixThemes()" class="btn-secondary" :disabled="!canProceed()">
                            <div>üé® Choose Post Mix & Themes</div>
                            <div style="font-size: 0.75rem; opacity: 0.7; margin-top: 0.25rem;">Manual configuration
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Post Type Mix & Content Types (NEW CARD UI) -->
            <div x-show="workflow.currentStep === 2" class="card">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                    <h2 style="font-size: 1.5rem; font-weight: 700;">Step 2: Post Mix & Themes</h2>
                    <button @click="goBack()" class="btn-secondary">‚Üê Back</button>
                </div>

                <p style="color: #718096; font-size: 0.875rem; margin-bottom: 2rem;">Select post types and distribute
                    content themes. Each type must have themes that sum to its total count.</p>

                <!-- Post Type Cards Grid -->
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <!-- Image Posts -->
                    <div class="post-type-card" :class="{ 'active': workflow.types.image.count > 0 }">
                        <div
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 120px; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: white;">
                            üì∑
                        </div>
                        <div style="padding: 1.5rem;">
                            <div style="font-weight: 600; font-size: 1.125rem; margin-bottom: 0.5rem;">Image Posts</div>
                            <div style="color: #718096; font-size: 0.875rem; margin-bottom: 1rem;">Single photo with
                                caption</div>

                            <label
                                style="display: block; font-weight: 500; font-size: 0.875rem; margin-bottom: 0.5rem;">How
                                many Image Posts?</label>
                            <input type="number" x-model.number="workflow.types.image.count" class="form-control"
                                min="0" @input="resetSplitIfZero('image')">

                            <div x-show="workflow.types.image.count > 0" style="margin-top: 1rem;">
                                <div
                                    style="font-size: 0.875rem; font-weight: 500; margin-bottom: 0.75rem; color: #374151;">
                                    Distribute content types <span style="font-size: 0.75rem; color: #6b7280;">(must
                                        total <span x-text="workflow.types.image.count"></span>)</span></div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                    <input type="number" x-model.number="workflow.types.image.split.educational"
                                        class="form-control" placeholder="üìö Educational" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.image.split.entertaining"
                                        class="form-control" placeholder="üéâ Entertaining" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.image.split.promotional"
                                        class="form-control" placeholder="üéØ Promotional" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.image.split.ugc"
                                        class="form-control" placeholder="üë• UGC" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.image.split.seasonal"
                                        class="form-control" placeholder="üåü Seasonal" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.image.split.reactive"
                                        class="form-control" placeholder="‚ö° Reactive" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                </div>
                                <div style="margin-top: 0.75rem; text-align: center;">
                                    <span class="badge"
                                        :class="isTypeBalanced('image') ? 'badge-success' : 'badge-warning'">
                                        <template x-if="isTypeBalanced('image')">
                                            <span>‚úÖ Balanced</span>
                                        </template>
                                        <template x-if="!isTypeBalanced('image')">
                                            <span
                                                x-text="deltaForType('image') > 0 ? `Needs ${deltaForType('image')} more` : `Over by ${Math.abs(deltaForType('image'))}`"></span>
                                        </template>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Carousel Posts -->
                    <div class="post-type-card" :class="{ 'active': workflow.types.carousel.count > 0 }">
                        <div
                            style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); height: 120px; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: white;">
                            üé†
                        </div>
                        <div style="padding: 1.5rem;">
                            <div style="font-weight: 600; font-size: 1.125rem; margin-bottom: 0.5rem;">Carousels</div>
                            <div style="color: #718096; font-size: 0.875rem; margin-bottom: 1rem;">Multiple swipeable
                                images</div>

                            <label
                                style="display: block; font-weight: 500; font-size: 0.875rem; margin-bottom: 0.5rem;">How
                                many Carousels?</label>
                            <input type="number" x-model.number="workflow.types.carousel.count" class="form-control"
                                min="0" @input="resetSplitIfZero('carousel')">

                            <div x-show="workflow.types.carousel.count > 0" style="margin-top: 1rem;">
                                <div
                                    style="font-size: 0.875rem; font-weight: 500; margin-bottom: 0.75rem; color: #374151;">
                                    Distribute content types <span style="font-size: 0.75rem; color: #6b7280;">(must
                                        total <span x-text="workflow.types.carousel.count"></span>)</span></div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                    <input type="number" x-model.number="workflow.types.carousel.split.educational"
                                        class="form-control" placeholder="üìö Educational" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.carousel.split.entertaining"
                                        class="form-control" placeholder="üéâ Entertaining" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.carousel.split.promotional"
                                        class="form-control" placeholder="üéØ Promotional" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.carousel.split.ugc"
                                        class="form-control" placeholder="üë• UGC" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.carousel.split.seasonal"
                                        class="form-control" placeholder="üåü Seasonal" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.carousel.split.reactive"
                                        class="form-control" placeholder="‚ö° Reactive" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                </div>
                                <div style="margin-top: 0.75rem; text-align: center;">
                                    <span class="badge"
                                        :class="isTypeBalanced('carousel') ? 'badge-success' : 'badge-warning'">
                                        <template x-if="isTypeBalanced('carousel')">
                                            <span>‚úÖ Balanced</span>
                                        </template>
                                        <template x-if="!isTypeBalanced('carousel')">
                                            <span
                                                x-text="deltaForType('carousel') > 0 ? `Needs ${deltaForType('carousel')} more` : `Over by ${Math.abs(deltaForType('carousel'))}`"></span>
                                        </template>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Video Posts -->
                    <div class="post-type-card" :class="{ 'active': workflow.types.video.count > 0 }">
                        <div
                            style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); height: 120px; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: white;">
                            üé¨
                        </div>
                        <div style="padding: 1.5rem;">
                            <div style="font-weight: 600; font-size: 1.125rem; margin-bottom: 0.5rem;">Videos</div>
                            <div style="color: #718096; font-size: 0.875rem; margin-bottom: 1rem;">Video content posts
                            </div>

                            <label
                                style="display: block; font-weight: 500; font-size: 0.875rem; margin-bottom: 0.5rem;">How
                                many Videos?</label>
                            <input type="number" x-model.number="workflow.types.video.count" class="form-control"
                                min="0" @input="resetSplitIfZero('video')">

                            <div x-show="workflow.types.video.count > 0" style="margin-top: 1rem;">
                                <div
                                    style="font-size: 0.875rem; font-weight: 500; margin-bottom: 0.75rem; color: #374151;">
                                    Distribute content types <span style="font-size: 0.75rem; color: #6b7280;">(must
                                        total <span x-text="workflow.types.video.count"></span>)</span></div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                    <input type="number" x-model.number="workflow.types.video.split.educational"
                                        class="form-control" placeholder="üìö Educational" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.video.split.entertaining"
                                        class="form-control" placeholder="üéâ Entertaining" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.video.split.promotional"
                                        class="form-control" placeholder="üéØ Promotional" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.video.split.ugc"
                                        class="form-control" placeholder="üë• UGC" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.video.split.seasonal"
                                        class="form-control" placeholder="üåü Seasonal" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.video.split.reactive"
                                        class="form-control" placeholder="‚ö° Reactive" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                </div>
                                <div style="margin-top: 0.75rem; text-align: center;">
                                    <span class="badge"
                                        :class="isTypeBalanced('video') ? 'badge-success' : 'badge-warning'">
                                        <template x-if="isTypeBalanced('video')">
                                            <span>‚úÖ Balanced</span>
                                        </template>
                                        <template x-if="!isTypeBalanced('video')">
                                            <span
                                                x-text="deltaForType('video') > 0 ? `Needs ${deltaForType('video')} more` : `Over by ${Math.abs(deltaForType('video'))}`"></span>
                                        </template>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Poll Posts -->
                    <div class="post-type-card" :class="{ 'active': workflow.types.poll.count > 0 }">
                        <div
                            style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); height: 120px; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: white;">
                            üìä
                        </div>
                        <div style="padding: 1.5rem;">
                            <div style="font-weight: 600; font-size: 1.125rem; margin-bottom: 0.5rem;">Polls</div>
                            <div style="color: #718096; font-size: 0.875rem; margin-bottom: 1rem;">Interactive polls
                            </div>

                            <label
                                style="display: block; font-weight: 500; font-size: 0.875rem; margin-bottom: 0.5rem;">How
                                many Polls?</label>
                            <input type="number" x-model.number="workflow.types.poll.count" class="form-control" min="0"
                                @input="resetSplitIfZero('poll')">

                            <div x-show="workflow.types.poll.count > 0" style="margin-top: 1rem;">
                                <div
                                    style="font-size: 0.875rem; font-weight: 500; margin-bottom: 0.75rem; color: #374151;">
                                    Distribute content types <span style="font-size: 0.75rem; color: #6b7280;">(must
                                        total <span x-text="workflow.types.poll.count"></span>)</span></div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                    <input type="number" x-model.number="workflow.types.poll.split.educational"
                                        class="form-control" placeholder="üìö Educational" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.poll.split.entertaining"
                                        class="form-control" placeholder="üéâ Entertaining" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.poll.split.promotional"
                                        class="form-control" placeholder="üéØ Promotional" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.poll.split.ugc"
                                        class="form-control" placeholder="üë• UGC" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.poll.split.seasonal"
                                        class="form-control" placeholder="üåü Seasonal" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.poll.split.reactive"
                                        class="form-control" placeholder="‚ö° Reactive" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                </div>
                                <div style="margin-top: 0.75rem; text-align: center;">
                                    <span class="badge"
                                        :class="isTypeBalanced('poll') ? 'badge-success' : 'badge-warning'">
                                        <template x-if="isTypeBalanced('poll')">
                                            <span>‚úÖ Balanced</span>
                                        </template>
                                        <template x-if="!isTypeBalanced('poll')">
                                            <span
                                                x-text="deltaForType('poll') > 0 ? `Needs ${deltaForType('poll')} more` : `Over by ${Math.abs(deltaForType('poll'))}`"></span>
                                        </template>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Story Posts -->
                    <div class="post-type-card" :class="{ 'active': workflow.types.story.count > 0 }">
                        <div
                            style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); height: 120px; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: white;">
                            üì±
                        </div>
                        <div style="padding: 1.5rem;">
                            <div style="font-weight: 600; font-size: 1.125rem; margin-bottom: 0.5rem;">Stories</div>
                            <div style="color: #718096; font-size: 0.875rem; margin-bottom: 1rem;">24-hour ephemeral
                                content</div>

                            <label
                                style="display: block; font-weight: 500; font-size: 0.875rem; margin-bottom: 0.5rem;">How
                                many Stories?</label>
                            <input type="number" x-model.number="workflow.types.story.count" class="form-control"
                                min="0" @input="resetSplitIfZero('story')">

                            <div x-show="workflow.types.story.count > 0" style="margin-top: 1rem;">
                                <div
                                    style="font-size: 0.875rem; font-weight: 500; margin-bottom: 0.75rem; color: #374151;">
                                    Distribute content types <span style="font-size: 0.75rem; color: #6b7280;">(must
                                        total <span x-text="workflow.types.story.count"></span>)</span></div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                    <input type="number" x-model.number="workflow.types.story.split.educational"
                                        class="form-control" placeholder="üìö Educational" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.story.split.entertaining"
                                        class="form-control" placeholder="üéâ Entertaining" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.story.split.promotional"
                                        class="form-control" placeholder="üéØ Promotional" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.story.split.ugc"
                                        class="form-control" placeholder="üë• UGC" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.story.split.seasonal"
                                        class="form-control" placeholder="üåü Seasonal" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.story.split.reactive"
                                        class="form-control" placeholder="‚ö° Reactive" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                </div>
                                <div style="margin-top: 0.75rem; text-align: center;">
                                    <span class="badge"
                                        :class="isTypeBalanced('story') ? 'badge-success' : 'badge-warning'">
                                        <template x-if="isTypeBalanced('story')">
                                            <span>‚úÖ Balanced</span>
                                        </template>
                                        <template x-if="!isTypeBalanced('story')">
                                            <span
                                                x-text="deltaForType('story') > 0 ? `Needs ${deltaForType('story')} more` : `Over by ${Math.abs(deltaForType('story'))}`"></span>
                                        </template>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Link Posts -->
                    <div class="post-type-card" :class="{ 'active': workflow.types.link.count > 0 }">
                        <div
                            style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); height: 120px; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: white;">
                            üîó
                        </div>
                        <div style="padding: 1.5rem;">
                            <div style="font-weight: 600; font-size: 1.125rem; margin-bottom: 0.5rem;">Link Posts</div>
                            <div style="color: #718096; font-size: 0.875rem; margin-bottom: 1rem;">Share external links
                            </div>

                            <label
                                style="display: block; font-weight: 500; font-size: 0.875rem; margin-bottom: 0.5rem;">How
                                many Link Posts?</label>
                            <input type="number" x-model.number="workflow.types.link.count" class="form-control" min="0"
                                @input="resetSplitIfZero('link')">

                            <div x-show="workflow.types.link.count > 0" style="margin-top: 1rem;">
                                <div
                                    style="font-size: 0.875rem; font-weight: 500; margin-bottom: 0.75rem; color: #374151;">
                                    Distribute content types <span style="font-size: 0.75rem; color: #6b7280;">(must
                                        total <span x-text="workflow.types.link.count"></span>)</span></div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                    <input type="number" x-model.number="workflow.types.link.split.educational"
                                        class="form-control" placeholder="üìö Educational" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.link.split.entertaining"
                                        class="form-control" placeholder="üéâ Entertaining" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.link.split.promotional"
                                        class="form-control" placeholder="üéØ Promotional" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.link.split.ugc"
                                        class="form-control" placeholder="üë• UGC" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.link.split.seasonal"
                                        class="form-control" placeholder="üåü Seasonal" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                    <input type="number" x-model.number="workflow.types.link.split.reactive"
                                        class="form-control" placeholder="‚ö° Reactive" min="0"
                                        style="padding: 0.5rem; font-size: 0.875rem;">
                                </div>
                                <div style="margin-top: 0.75rem; text-align: center;">
                                    <span class="badge"
                                        :class="isTypeBalanced('link') ? 'badge-success' : 'badge-warning'">
                                        <template x-if="isTypeBalanced('link')">
                                            <span>‚úÖ Balanced</span>
                                        </template>
                                        <template x-if="!isTypeBalanced('link')">
                                            <span
                                                x-text="deltaForType('link') > 0 ? `Needs ${deltaForType('link')} more` : `Over by ${Math.abs(deltaForType('link'))}`"></span>
                                        </template>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Overall Status -->
                <div
                    style="background: linear-gradient(135deg, rgba(80, 70, 229, 0.1), rgba(0, 196, 204, 0.1)); padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 2rem; text-align: center;">
                    <div style="font-size: 0.875rem; color: #718096; margin-bottom: 0.5rem;">Total Posts Planned</div>
                    <div style="font-size: 2.5rem; font-weight: 700; color: var(--primary);"
                        x-text="totalPlannedCount()"></div>

                    <div x-show="totalPlannedCount() > 0 && !allActiveTypesBalanced()" style="margin-top: 1rem;">
                        <span class="badge badge-warning">‚ö†Ô∏è Some types need balancing</span>
                    </div>
                    <div x-show="totalPlannedCount() > 0 && allActiveTypesBalanced()" style="margin-top: 1rem;">
                        <span class="badge badge-success">‚úÖ All types balanced and ready!</span>
                    </div>
                </div>

                <!-- Actions -->
                <div style="display: flex; justify-content: space-between;">
                    <button @click="goBack()" class="btn-secondary">‚Üê Back</button>
                    <button @click="generatePlanFromMix()" class="btn-primary"
                        :disabled="totalPlannedCount() === 0 || !allActiveTypesBalanced() || isGenerating">
                        <span x-show="!isGenerating">Generate Plan & Content ‚Üí</span>
                        <span x-show="isGenerating">‚è≥ Generating...</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Calendar -->
        <div x-show="activeView === 'calendar'">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                <div>
                    <h1 style="font-size: 1.875rem; font-weight: 700; margin-bottom: 0.5rem;">Calendar</h1>
                    <p style="color: #718096;">Manage your content schedule</p>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button @click="calendar.view = 'list'" class="btn-secondary"
                        :style="calendar.view === 'list' ? 'background: var(--primary); color: white;' : ''">List</button>
                    <button @click="calendar.view = 'month'" class="btn-secondary"
                        :style="calendar.view === 'month' ? 'background: var(--primary); color: white;' : ''">Month</button>
                </div>
            </div>

            <button @click="backToWorkflow()" class="btn-secondary" style="margin-bottom: 1rem;">‚Üê Back to
                Workflow</button>

            <!-- List View -->
            <div x-show="calendar.view === 'list'" class="card">
                <template x-if="workflow.generatedItems.length === 0">
                    <div style="text-align: center; padding: 3rem; color: #718096;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üìÖ</div>
                        <p>No content scheduled yet. Create a campaign to get started!</p>
                    </div>
                </template>

                <template x-if="workflow.generatedItems.length > 0">
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="border-bottom: 2px solid #e2e8f0;">
                                    <th style="text-align: left; padding: 0.75rem;">Date/Time</th>
                                    <th style="text-align: left; padding: 0.75rem;">Type</th>
                                    <th style="text-align: left; padding: 0.75rem;">Theme</th>
                                    <th style="text-align: left; padding: 0.75rem;">Language</th>
                                    <th style="text-align: left; padding: 0.75rem;">Status</th>
                                    <th style="text-align: left; padding: 0.75rem;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="item in workflow.generatedItems" :key="item.id">
                                    <tr style="border-bottom: 1px solid #e2e8f0;" class="post-item-row">
                                        <td style="padding: 0.75rem;" x-text="item.date + ' ' + item.time"></td>
                                        <td style="padding: 0.75rem;" x-text="item.type"></td>
                                        <td style="padding: 0.75rem;" x-text="item.theme"></td>
                                        <td style="padding: 0.75rem;" x-text="item.lang"></td>
                                        <td style="padding: 0.75rem;">
                                            <span class="badge"
                                                :class="item.status === 'scheduled' ? 'badge-success' : item.status === 'published' ? 'badge-primary' : 'badge-warning'"
                                                x-text="item.status"></span>
                                        </td>
                                        <td style="padding: 0.75rem;">
                                            <div style="display: flex; gap: 0.5rem;">
                                                <button @click="openPostEditor(item.id)" class="btn-secondary"
                                                    style="padding: 0.25rem 0.75rem; font-size: 0.875rem;">Edit</button>
                                                <button @click="movePost(item.id)" class="btn-secondary"
                                                    style="padding: 0.25rem 0.75rem; font-size: 0.875rem;">üìÖ
                                                    Move</button>
                                                <button @click="deletePostFromCalendar(item.id)" class="btn-secondary"
                                                    style="padding: 0.25rem 0.75rem; font-size: 0.875rem; color: #dc2626; border-color: #fecaca;">üóëÔ∏è</button>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </template>
            </div>

            <!-- Month View -->
            <div x-show="calendar.view === 'month'" class="card">
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; margin-bottom: 0.5rem;">
                    <div style="font-weight: 600; text-align: center; padding: 0.5rem;">Sun</div>
                    <div style="font-weight: 600; text-align: center; padding: 0.5rem;">Mon</div>
                    <div style="font-weight: 600; text-align: center; padding: 0.5rem;">Tue</div>
                    <div style="font-weight: 600; text-align: center; padding: 0.5rem;">Wed</div>
                    <div style="font-weight: 600; text-align: center; padding: 0.5rem;">Thu</div>
                    <div style="font-weight: 600; text-align: center; padding: 0.5rem;">Fri</div>
                    <div style="font-weight: 600; text-align: center; padding: 0.5rem;">Sat</div>
                </div>
                <div
                    style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #e2e8f0; border: 1px solid #e2e8f0;">
                    <template x-for="day in 35" :key="day">
                        <div style="background: white; min-height: 100px; padding: 0.5rem;">
                            <div style="font-size: 0.875rem; font-weight: 500; margin-bottom: 0.25rem;" x-text="day">
                            </div>
                            <template x-for="item in getItemsForDay(day)" :key="item.id">
                                <div class="post-item" title="Click to view & edit">
                                    <div @click="openPostEditor(item.id)" x-text="item.type" style="cursor: pointer;">
                                    </div>
                                    <div @click="openPostEditor(item.id)" style="font-size: 0.625rem; cursor: pointer;"
                                        x-text="item.time"></div>
                                    <div style="display: flex; gap: 0.25rem; margin-top: 0.25rem;">
                                        <button @click.stop="movePost(item.id)"
                                            style="font-size: 0.625rem; padding: 0.125rem 0.25rem; background: white; border: 1px solid #e2e8f0; border-radius: 0.25rem; cursor: pointer;"
                                            title="Move">üìÖ</button>
                                        <button @click.stop="deletePostFromCalendar(item.id)"
                                            style="font-size: 0.625rem; padding: 0.125rem 0.25rem; background: white; border: 1px solid #fecaca; color: #dc2626; border-radius: 0.25rem; cursor: pointer;"
                                            title="Delete">üóëÔ∏è</button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Single Post Editor -->
        <div x-show="activeView === 'postEditor'" x-data="{ currentLang: 'en' }">
            <div style="margin-bottom: 1.5rem;">
                <button @click="closePostEditor()" class="btn-secondary">‚Üê Back to Calendar</button>
            </div>

            <div class="card">
                <template x-if="getSelectedPost()">
                    <div>
                        <!-- Header -->
                        <div
                            style="display: flex; align-items: start; justify-content: space-between; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 2px solid #e5e7eb;">
                            <div>
                                <h2
                                    style="font-size: 1.875rem; font-weight: 700; margin-bottom: 0.75rem; color: #1a202c;">
                                    Edit Post</h2>
                                <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                                    <div
                                        style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.375rem 0.75rem; background: rgba(80, 70, 229, 0.1); border-radius: 0.5rem;">
                                        <span style="font-size: 1.125rem;">üìù</span>
                                        <span style="font-weight: 600; color: var(--primary); font-size: 0.875rem;"
                                            x-text="getSelectedPost().type"></span>
                                    </div>
                                    <div
                                        style="color: #718096; font-size: 0.875rem; display: flex; align-items: center; gap: 0.375rem;">
                                        <span>üìÖ</span>
                                        <span x-text="getSelectedPost().date + ' at ' + getSelectedPost().time"></span>
                                    </div>
                                    <span class="badge"
                                        :class="getSelectedPost().status === 'scheduled' ? 'badge-success' : getSelectedPost().status === 'published' ? 'badge-primary' : 'badge-warning'"
                                        x-text="getSelectedPost().status"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Language Toggle (if multilingual) -->
                        <div x-show="workflow.isMultilingual && workflow.additionalLanguages.length > 0"
                            style="margin-bottom: 2rem;">
                            <label
                                style="display: block; font-weight: 600; margin-bottom: 0.75rem; color: #1a202c; font-size: 0.875rem;">Select
                                Language to Edit</label>
                            <div style="position: relative; display: inline-block;">
                                <select x-model="currentLang" class="form-control"
                                    style="padding: 0.75rem 2.5rem 0.75rem 1rem; font-weight: 500; appearance: none; background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg width=\'12\' height=\'8\' viewBox=\'0 0 12 8\' fill=\'none\' xmlns=\'http://www.w3.org/2000/svg\'%3e%3cpath d=\'M1 1.5L6 6.5L11 1.5\' stroke=\'%23718096\' stroke-width=\'2\' stroke-linecap=\'round\' stroke-linejoin=\'round\'/%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 0.75rem center; min-width: 200px;">
                                    <option :value="workflow.primaryLanguage"
                                        x-text="workflow.primaryLanguage === 'en' ? 'üá∫üá∏ English (Primary)' : workflow.primaryLanguage === 'es' ? 'üá™üá∏ Spanish (Primary)' : workflow.primaryLanguage === 'fr' ? 'üá´üá∑ French (Primary)' : 'üá©üá™ German (Primary)'">
                                    </option>
                                    <template x-for="lang in workflow.additionalLanguages" :key="lang">
                                        <option :value="lang"
                                            x-text="lang === 'en' ? 'üá∫üá∏ English' : lang === 'es' ? 'üá™üá∏ Spanish' : lang === 'fr' ? 'üá´üá∑ French' : 'üá©üá™ German'">
                                        </option>
                                    </template>
                                </select>
                            </div>
                            <p style="font-size: 0.75rem; color: #718096; margin-top: 0.5rem;">
                                Switch between languages to edit content for each version
                            </p>
                        </div>

                        <!-- Main Grid: Editor + Preview -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                            <!-- Left Column: Content Editor -->
                            <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                                <!-- Caption -->
                                <div>
                                    <label
                                        style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #1a202c; font-size: 0.875rem;">
                                        Generated Caption
                                        <span
                                            x-show="workflow.isMultilingual && workflow.additionalLanguages.length > 0"
                                            style="font-weight: 400; color: #718096; font-size: 0.75rem;"
                                            x-text="`(${currentLang === 'en' ? 'English' : currentLang === 'es' ? 'Spanish' : currentLang === 'fr' ? 'French' : 'German'})`">
                                        </span>
                                    </label>
                                    <textarea x-model="getSelectedPost().caption" class="form-control" rows="8"
                                        placeholder="Write your post caption..."
                                        style="font-size: 0.875rem; line-height: 1.6;"></textarea>
                                    <div style="display: flex; gap: 1rem; margin-top: 0.75rem; flex-wrap: wrap;">
                                        <button @click="regeneratePost()"
                                            style="font-size: 0.875rem; color: var(--primary); display: inline-flex; align-items: center; gap: 0.375rem; background: none; border: none; cursor: pointer; padding: 0; font-weight: 500;">
                                            <span>üîÑ</span>
                                            <span>Regenerate</span>
                                        </button>
                                        <button @click="enhancePost()"
                                            style="font-size: 0.875rem; color: var(--primary); display: inline-flex; align-items: center; gap: 0.375rem; background: none; border: none; cursor: pointer; padding: 0; font-weight: 500;">
                                            <span>‚ú®</span>
                                            <span>Enhance</span>
                                        </button>
                                        <button
                                            x-show="workflow.isMultilingual && workflow.additionalLanguages.length > 0"
                                            @click="translateToAll()"
                                            style="font-size: 0.875rem; color: var(--primary); display: inline-flex; align-items: center; gap: 0.375rem; background: none; border: none; cursor: pointer; padding: 0; font-weight: 500;">
                                            <span>üåê</span>
                                            <span>Translate to All</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Hashtags -->
                                <div>
                                    <label
                                        style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #1a202c; font-size: 0.875rem;">
                                        Hashtags
                                        <span
                                            x-show="workflow.isMultilingual && workflow.additionalLanguages.length > 0"
                                            style="font-weight: 400; color: #718096; font-size: 0.75rem;"
                                            x-text="`(${currentLang === 'en' ? 'English' : currentLang === 'es' ? 'Spanish' : currentLang === 'fr' ? 'French' : 'German'})`">
                                        </span>
                                    </label>
                                    <div
                                        style="display: flex; flex-wrap: wrap; gap: 0.5rem; padding: 0.75rem; background: #f9fafb; border-radius: 0.5rem; border: 1px solid #e5e7eb; min-height: 3rem;">
                                        <span
                                            style="background: #dbeafe; color: #1e40af; padding: 0.375rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500;">#Innovation</span>
                                        <span
                                            style="background: #dbeafe; color: #1e40af; padding: 0.375rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500;">#Marketing</span>
                                        <span
                                            style="background: #dbeafe; color: #1e40af; padding: 0.375rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500;">#Business</span>
                                        <span
                                            style="background: #dbeafe; color: #1e40af; padding: 0.375rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500;">#Tech</span>
                                        <span
                                            style="background: #dbeafe; color: #1e40af; padding: 0.375rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500;">#Growth</span>
                                    </div>
                                    <button
                                        style="font-size: 0.875rem; color: var(--primary); margin-top: 0.5rem; background: none; border: none; cursor: pointer; padding: 0; font-weight: 500;">üîÑ
                                        Generate new hashtags</button>
                                </div>

                                <!-- Schedule -->
                                <div>
                                    <label
                                        style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #1a202c; font-size: 0.875rem;">Schedule</label>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                                        <input type="date" x-model="getSelectedPost().date" class="form-control"
                                            style="font-size: 0.875rem;">
                                        <input type="time" x-model="getSelectedPost().time" class="form-control"
                                            style="font-size: 0.875rem;">
                                    </div>
                                </div>

                                <!-- AI Recommendation Box -->
                                <div
                                    style="background: linear-gradient(135deg, rgba(80, 70, 229, 0.05), rgba(0, 196, 204, 0.05)); border-left: 3px solid var(--primary); padding: 1rem; border-radius: 0.5rem;">
                                    <h4
                                        style="font-weight: 600; color: var(--primary); margin-bottom: 0.5rem; font-size: 0.875rem; display: flex; align-items: center; gap: 0.5rem;">
                                        <span>ü§ñ</span>
                                        <span>AI Recommendation</span>
                                    </h4>
                                    <p style="font-size: 0.875rem; color: #374151; margin: 0;">Based on your audience
                                        analysis, the optimal posting time is Tuesday at 2:00 PM for maximum engagement.
                                    </p>
                                </div>

                                <!-- Media Upload -->
                                <div>
                                    <label
                                        style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: #1a202c; font-size: 0.875rem;">Media</label>
                                    <div style="border: 2px dashed #e5e7eb; border-radius: 0.75rem; padding: 2rem; text-align: center; color: #9ca3af; background: #fafafa; transition: all 0.2s; cursor: pointer;"
                                        onmouseover="this.style.borderColor='var(--primary)'; this.style.background='rgba(80, 70, 229, 0.02)'"
                                        onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='#fafafa'">
                                        <div style="font-size: 2.5rem; margin-bottom: 0.75rem;">üì∏</div>
                                        <div style="font-size: 0.875rem; font-weight: 500; color: #374151;">Click to
                                            upload or drag and drop</div>
                                        <div style="font-size: 0.75rem; margin-top: 0.375rem;">PNG, JPG, MP4 up to 10MB
                                        </div>
                                    </div>
                                    <div
                                        style="display: flex; gap: 1rem; margin-top: 0.75rem; justify-content: center;">
                                        <button @click="regenerateImage()"
                                            style="font-size: 0.875rem; color: var(--primary); display: inline-flex; align-items: center; gap: 0.375rem; background: none; border: none; cursor: pointer; padding: 0; font-weight: 500;">
                                            <span>üé®</span>
                                            <span>Regenerate Image with AI</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Column: Live Preview + Info -->
                            <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                                <div>
                                    <h3
                                        style="font-weight: 600; margin-bottom: 1rem; font-size: 1rem; color: #1a202c; display: flex; align-items: center; gap: 0.5rem;">
                                        <span>üì±</span>
                                        <span>Live Preview</span>
                                    </h3>

                                    <!-- Facebook Preview Card -->
                                    <div
                                        style="border: 1px solid #e2e8f0; border-radius: 0.75rem; background: white; overflow: hidden; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">
                                        <!-- Post Header -->
                                        <div style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                                            <div style="display: flex; align-items: center;">
                                                <div
                                                    style="width: 2.5rem; height: 2.5rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1rem;">
                                                    B
                                                </div>
                                                <div style="margin-left: 0.75rem; flex: 1;">
                                                    <div style="font-weight: 600; font-size: 0.875rem; color: #1a202c;">
                                                        Your Brand</div>
                                                    <div
                                                        style="font-size: 0.75rem; color: #65676b; display: flex; align-items: center; gap: 0.25rem;">
                                                        <span>2 min</span>
                                                        <span>‚Ä¢</span>
                                                        <span>üåê</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Post Content -->
                                        <div style="padding: 1rem;">
                                            <p style="font-size: 0.875rem; line-height: 1.6; color: #1a202c; white-space: pre-wrap; margin: 0;"
                                                x-text="getSelectedPost().caption"></p>
                                            <div
                                                style="margin-top: 0.75rem; display: flex; flex-wrap: wrap; gap: 0.375rem;">
                                                <span
                                                    style="color: #385898; font-size: 0.875rem; font-weight: 500;">#Innovation</span>
                                                <span
                                                    style="color: #385898; font-size: 0.875rem; font-weight: 500;">#Marketing</span>
                                                <span
                                                    style="color: #385898; font-size: 0.875rem; font-weight: 500;">#Business</span>
                                                <span
                                                    style="color: #385898; font-size: 0.875rem; font-weight: 500;">#Tech</span>
                                            </div>
                                        </div>

                                        <!-- Image Placeholder -->
                                        <div x-show="getSelectedPost().type !== 'Text Post'"
                                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 16rem; display: flex; align-items: center; justify-content: center; position: relative;">
                                            <div style="text-align: center; color: white;">
                                                <div style="font-size: 3rem; margin-bottom: 0.5rem;">üé®</div>
                                                <div style="font-size: 0.875rem; font-weight: 500;">Generated Image
                                                    Preview</div>
                                            </div>
                                        </div>

                                        <!-- Engagement Actions -->
                                        <div
                                            style="padding: 0.75rem 1rem; border-top: 1px solid #e5e7eb; display: flex; justify-content: space-around;">
                                            <div
                                                style="display: flex; align-items: center; gap: 0.375rem; color: #65676b; font-size: 0.875rem; font-weight: 500;">
                                                <span>üëç</span>
                                                <span>Like</span>
                                            </div>
                                            <div
                                                style="display: flex; align-items: center; gap: 0.375rem; color: #65676b; font-size: 0.875rem; font-weight: 500;">
                                                <span>üí¨</span>
                                                <span>Comment</span>
                                            </div>
                                            <div
                                                style="display: flex; align-items: center; gap: 0.375rem; color: #65676b; font-size: 0.875rem; font-weight: 500;">
                                                <span>‚ÜóÔ∏è</span>
                                                <span>Share</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Language Summary -->
                                    <div x-show="workflow.isMultilingual && workflow.additionalLanguages.length > 0"
                                        style="margin-top: 1rem; padding: 0.875rem; background: #ecfdf5; border: 1px solid #86efac; border-radius: 0.5rem;">
                                        <h4
                                            style="font-weight: 600; color: #047857; font-size: 0.875rem; margin-bottom: 0.375rem; display: flex; align-items: center; gap: 0.5rem;">
                                            <span>üåê</span>
                                            <span>Multilingual Content</span>
                                        </h4>
                                        <p style="font-size: 0.75rem; color: #065f46; margin: 0;">
                                            Content available in <span
                                                x-text="1 + workflow.additionalLanguages.length"></span> languages
                                        </p>
                                    </div>
                                </div>

                                <!-- Post Details Card -->
                                <div
                                    style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.75rem; padding: 1.25rem;">
                                    <h4
                                        style="font-weight: 600; margin-bottom: 1rem; color: #1a202c; font-size: 0.875rem;">
                                        Post Details</h4>
                                    <div style="display: grid; gap: 0.75rem; font-size: 0.875rem;">
                                        <div
                                            style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="color: #6b7280;">Type:</span>
                                            <span style="font-weight: 600; color: #1a202c;"
                                                x-text="getSelectedPost().type"></span>
                                        </div>
                                        <div
                                            style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="color: #6b7280;">Theme:</span>
                                            <span style="font-weight: 600; color: #1a202c;"
                                                x-text="getSelectedPost().theme"></span>
                                        </div>
                                        <div
                                            style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="color: #6b7280;">Language:</span>
                                            <span style="font-weight: 600; color: #1a202c;"
                                                x-text="getSelectedPost().lang"></span>
                                        </div>
                                        <div
                                            style="display: flex; justify-content: space-between; align-items: center;">
                                            <span style="color: #6b7280;">Created:</span>
                                            <span style="font-weight: 600; color: #1a202c;">Just now</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div
                            style="display: flex; gap: 0.75rem; justify-content: space-between; padding-top: 2rem; border-top: 2px solid #e5e7eb;">
                            <button @click="deletePost()" class="btn-secondary"
                                style="color: #dc2626; border-color: #fecaca;">
                                <span>üóëÔ∏è</span>
                                <span>Delete</span>
                            </button>
                            <div style="display: flex; gap: 0.75rem;">
                                <button @click="savePost()" class="btn-secondary">
                                    <span>üíæ</span>
                                    <span>Save as Draft</span>
                                </button>
                                <button @click="schedulePost()" class="btn-primary">
                                    <span>üìÖ</span>
                                    <span>Schedule Post</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Settings -->
        <div x-show="activeView === 'settings'">
            <h1 style="font-size: 1.875rem; font-weight: 700; margin-bottom: 1.5rem;">Settings</h1>

            <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 2px solid #e2e8f0;">
                <div class="tab" :class="{'active': settingsTab === 'personas'}" @click="settingsTab = 'personas'">
                    Personas</div>
                <div class="tab" :class="{'active': settingsTab === 'brands'}" @click="settingsTab = 'brands'">Brands
                </div>
            </div>

            <!-- Personas Tab -->
            <div x-show="settingsTab === 'personas'" class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2 style="font-size: 1.25rem; font-weight: 700;">Manage Personas</h2>
                    <button @click="addPersona()" class="btn-primary">+ Add Persona</button>
                </div>

                <div style="display: grid; gap: 1rem;">
                    <template x-for="persona in personas" :key="persona.id">
                        <div style="border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <div style="font-weight: 600; font-size: 1.125rem;" x-text="persona.name"></div>
                                    <div style="font-size: 0.875rem; color: #718096; margin-top: 0.25rem;"
                                        x-text="persona.summary"></div>
                                    <div style="margin-top: 0.5rem;">
                                        <span class="badge"
                                            :class="persona.type === 'AI' ? 'badge-primary' : 'badge-success'"
                                            x-text="persona.type"></span>
                                    </div>
                                </div>
                                <button class="btn-secondary" style="padding: 0.5rem 1rem;">Edit</button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Brands Tab -->
            <div x-show="settingsTab === 'brands'" class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h2 style="font-size: 1.25rem; font-weight: 700;">Manage Brands</h2>
                    <button @click="addBrand()" class="btn-primary">+ Add Brand</button>
                </div>

                <div style="display: grid; gap: 1rem;">
                    <template x-for="brand in brands" :key="brand.id">
                        <div style="border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <div style="font-weight: 600; font-size: 1.125rem;" x-text="brand.name"></div>
                                    <div style="font-size: 0.875rem; color: #718096; margin-top: 0.25rem;"
                                        x-text="brand.description"></div>
                                    <div style="margin-top: 0.5rem;">
                                        <span style="font-size: 0.75rem; color: #718096;">Voice: <span
                                                x-text="brand.voice"></span></span>
                                    </div>
                                </div>
                                <button class="btn-secondary" style="padding: 0.5rem 1rem;">Edit</button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </main>

    <script>
        function workflowApp() {
            return {
                activeView: 'workflow',
                settingsTab: 'personas',
                isGenerating: false,  // Add loading state

                personas: [],
                brands: [
                    { id: 'brand-001', name: 'TechBrand', description: 'Main Brand', voice: 'Professional' },
                    { id: 'brand-techflow-solutions', name: 'TechFlow Solutions', description: 'Leading innovation company', voice: 'Professional' },
                    { id: 'brand-creative-studio', name: 'Creative Studio', description: 'Design & Marketing partner', voice: 'Casual & Friendly' }
                ],
                products: [],

                workflow: {
                    currentStep: 1,
                    selectedPersonaIds: [],
                    selectedBrandId: 'brand-001',
                    campaignId: '',
                    name: '',
                    objective: 'awareness',
                    audience: '',
                    startDate: '',
                    endDate: '',
                    frequency: '1',
                    brandVoice: 'Professional',
                    primaryLanguage: 'en',
                    isMultilingual: false,
                    additionalLanguages: [],
                    useProducts: false,
                    selectedProductIds: [],
                    types: {
                        image: { count: 0, split: { educational: 0, entertaining: 0, promotional: 0, ugc: 0, seasonal: 0, reactive: 0 } },
                        carousel: { count: 0, split: { educational: 0, entertaining: 0, promotional: 0, ugc: 0, seasonal: 0, reactive: 0 } },
                        video: { count: 0, split: { educational: 0, entertaining: 0, promotional: 0, ugc: 0, seasonal: 0, reactive: 0 } },
                        poll: { count: 0, split: { educational: 0, entertaining: 0, promotional: 0, ugc: 0, seasonal: 0, reactive: 0 } },
                        story: { count: 0, split: { educational: 0, entertaining: 0, promotional: 0, ugc: 0, seasonal: 0, reactive: 0 } },
                        link: { count: 0, split: { educational: 0, entertaining: 0, promotional: 0, ugc: 0, seasonal: 0, reactive: 0 } }
                    },
                    generatedItems: []
                },

                async init() {
                    console.log('Campaign Workflow initialized');
                    await this.loadAll();
                },

                async loadAll() {
                    try {
                        const brandId = this.workflow.selectedBrandId || 'brand-001';
                        // Load Products
                        const prodResp = await fetch(`/api/v1/settings/products/${brandId}`);
                        if (prodResp.ok) {
                            const data = await prodResp.json();
                            this.products = data.products;
                        }

                        // Load Personas
                        const persResp = await fetch(`/api/v1/settings/personas/${brandId}`);
                        if (persResp.ok) {
                            const data = await persResp.json();
                            this.personas = data.personas.map(p => ({
                                ...p,
                                summary: `${p.age_range}, ${p.gender || 'Any'}, ${p.location || 'Global'}`
                            }));
                        }
                    } catch (e) {
                        console.error('Failed to load data:', e);
                    }
                },

                calendar: {
                    view: 'list'
                },

                postEditor: {
                    currentId: null
                },

                canProceed() {
                    return this.workflow.selectedBrandId &&
                        this.workflow.selectedPersonaIds.length > 0 &&
                        this.workflow.name &&
                        this.workflow.objective;
                },

                togglePersona(personaId) {
                    const index = this.workflow.selectedPersonaIds.indexOf(personaId);
                    if (index === -1) {
                        this.workflow.selectedPersonaIds.push(personaId);
                    } else {
                        this.workflow.selectedPersonaIds.splice(index, 1);
                    }
                },

                loadBrandDefaults() {
                    const brand = this.brands.find(b => b.id == this.workflow.selectedBrandId);
                    if (brand) {
                        this.workflow.brandVoice = brand.voice;
                        this.loadAll(); // Reload personas/products for this brand
                    }
                },

                createCampaignBlueprint() {
                    if (!this.canProceed()) return;

                    // Show loading state
                    this.isGenerating = true;

                    // Create campaign data from the form
                    const campaignData = {
                        campaign_name: this.workflow.name,
                        campaign_objective: this.workflow.objective || 'awareness',
                        target_audience: this.workflow.audience || 'General audience',
                        start_date: this.workflow.startDate || new Date().toISOString().split('T')[0],
                        end_date: this.workflow.endDate || new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                        frequency: parseInt(this.workflow.frequency) || 1,
                        selected_personas: this.workflow.selectedPersonaIds || ['persona-tech-enthusiast'],
                        selected_brand_id: this.workflow.selectedBrandId || 'brand-techflow-solutions',
                        product_integration_enabled: false,
                        selected_products: [],
                        language_config: {
                            primary_language: this.workflow.primaryLanguage || 'en',
                            multilingual_enabled: this.workflow.isMultilingual || false,
                            additional_languages: this.workflow.additionalLanguages || []
                        }
                    };

                    // Debug: Log the data being sent
                    console.log('üîç Campaign data being sent:', JSON.stringify(campaignData, null, 2));

                    // Call backend API to create campaign
                    fetch('/api/v1/campaigns/create', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(campaignData)
                    })
                        .then(async response => {
                            const data = await response.json();
                            if (!response.ok) {
                                throw new Error(data.detail || 'Failed to create campaign');
                            }
                            return data;
                        })
                        .then(data => {
                            if (data.campaign_id) {
                                // Store campaign ID for later use
                                this.workflow.campaignId = data.campaign_id;

                                // Extract AI strategy if available
                                const aiStrategy = data.data?.content_plan?.generated_plan || '';

                                // Generate items based on the number of days or fixed amount
                                const types = ['Image Post', 'Carousel', 'Video', 'Poll'];
                                const themes = ['Educational', 'Entertaining', 'Promotional', 'UGC'];

                                this.workflow.generatedItems = [];
                                for (let i = 0; i < 15; i++) {
                                    const date = new Date();
                                    date.setDate(date.getDate() + i);

                                    // Construct caption using AI strategy snippet
                                    let caption = `Post for ${this.workflow.name} - Day ${i + 1}. `;
                                    if (aiStrategy) {
                                        // Use a relevant part of the strategy or just a snippet
                                        caption += `\n‚ú® AI Strategy: ${aiStrategy.split('\n')[0].substring(0, 120)}...`;
                                    } else {
                                        caption += "This is AI-powered content generated by Prometrix.";
                                    }

                                    this.workflow.generatedItems.push({
                                        id: Date.now() + i,
                                        date: date.toISOString().split('T')[0],
                                        time: '14:00',
                                        type: types[Math.floor(Math.random() * types.length)],
                                        theme: themes[Math.floor(Math.random() * themes.length)],
                                        lang: this.workflow.primaryLanguage,
                                        caption: caption,
                                        status: 'draft'
                                    });
                                }

                                this.activeView = 'calendar';
                                this.isGenerating = false;
                                console.log('Campaign created successfully with AI strategy:', data);
                            } else {
                                throw new Error('No campaign ID received');
                            }
                        })
                        .catch(error => {
                            this.isGenerating = false;
                            console.error('‚ùå Error creating campaign:', error);
                            console.error('‚ùå Error details:', error.message);

                            // Try to get more details from the response
                            if (error.response) {
                                console.error('‚ùå Response status:', error.response.status);
                                console.error('‚ùå Response data:', error.response.data);
                            }

                            alert(`Failed to create campaign: ${error.message}`);

                            // Fallback logic removed to ensure user knows it failed
                        })
                        .finally(() => {
                            this.isGenerating = false;
                        });
                },

                goToMixThemes() {
                    if (!this.canProceed()) return;
                    this.workflow.currentStep = 2;
                },

                goBack() {
                    if (this.workflow.currentStep > 1) {
                        this.workflow.currentStep--;
                    }
                },

                totalPlannedCount() {
                    return Object.values(this.workflow.types).reduce((sum, type) => sum + type.count, 0);
                },

                sumSplit(typeKey) {
                    const s = this.workflow.types[typeKey].split;
                    return s.educational + s.entertaining + s.promotional + s.ugc + s.seasonal + s.reactive;
                },

                isTypeBalanced(typeKey) {
                    const t = this.workflow.types[typeKey];
                    if (t.count === 0) return true;
                    return this.sumSplit(typeKey) === t.count;
                },

                allActiveTypesBalanced() {
                    return Object.keys(this.workflow.types).every(k => this.isTypeBalanced(k));
                },

                deltaForType(typeKey) {
                    const t = this.workflow.types[typeKey];
                    return t.count - this.sumSplit(typeKey);
                },

                resetSplitIfZero(typeKey) {
                    if (this.workflow.types[typeKey].count === 0) {
                        this.workflow.types[typeKey].split = {
                            educational: 0, entertaining: 0, promotional: 0,
                            ugc: 0, seasonal: 0, reactive: 0
                        };
                    }
                },

                generatePlanFromMix() {
                    if (!this.allActiveTypesBalanced() || this.totalPlannedCount() === 0) return;

                    // Show loading state
                    this.isGenerating = true;

                    // Prepare post mix data for backend
                    const totalCount = this.totalPlannedCount();
                    const postMixData = {
                        campaign_id: this.workflow.campaignId || 'temp-campaign-id',
                        content_types: Object.keys(this.workflow.types).filter(key => this.workflow.types[key].count > 0),
                        post_distribution: {
                            educational: 0,
                            entertaining: 0,
                            promotional: 0,
                            ugc: 0,
                            seasonal: 0,
                            reactive: 0
                        }
                    };

                    if (totalCount > 0) {
                        // Calculate distribution from the existing split data
                        Object.keys(this.workflow.types).forEach(typeKey => {
                            const type = this.workflow.types[typeKey];
                            if (type.count > 0) {
                                const split = type.split;
                                postMixData.post_distribution.educational += split.educational || 0;
                                postMixData.post_distribution.entertaining += split.entertaining || 0;
                                postMixData.post_distribution.promotional += split.promotional || 0;
                                postMixData.post_distribution.ugc += split.ugc || 0;
                                postMixData.post_distribution.seasonal += split.seasonal || 0;
                                postMixData.post_distribution.reactive += split.reactive || 0;
                            }
                        });

                        // Convert counts to percentages that sum to 100
                        const keys = Object.keys(postMixData.post_distribution);
                        let sum = 0;
                        keys.forEach(k => {
                            postMixData.post_distribution[k] = Math.round((postMixData.post_distribution[k] / totalCount) * 100);
                            sum += postMixData.post_distribution[k];
                        });

                        // Adjust for rounding errors to ensure exactly 100%
                        if (sum !== 100 && sum > 0) {
                            const diff = 100 - sum;
                            const maxKey = keys.reduce((a, b) => postMixData.post_distribution[a] > postMixData.post_distribution[b] ? a : b);
                            postMixData.post_distribution[maxKey] += diff;
                        }
                    } else {
                        // Default distribution if count is 0
                        postMixData.post_distribution.educational = 100;
                    }

                    // Call backend API for post mix configuration
                    fetch('/api/v1/campaigns/post-mix', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(postMixData)
                    })
                        .then(async response => {
                            const data = await response.json();
                            if (!response.ok) {
                                console.error('‚ùå Post mix error details:', data);
                                throw new Error(data.detail?.[0]?.msg || 'Validation failed');
                            }
                            return data;
                        })
                        .then(data => {
                            console.log('Post mix configured:', data);

                            // Generate calendar items (keeping existing UI behavior)
                            this.workflow.generatedItems = [];
                            let itemId = Date.now();
                            let dayOffset = 0;

                            const typeLabels = {
                                image: 'Image Post',
                                carousel: 'Carousel',
                                video: 'Video',
                                poll: 'Poll',
                                story: 'Story',
                                link: 'Link Post'
                            };

                            Object.keys(this.workflow.types).forEach(typeKey => {
                                const type = this.workflow.types[typeKey];
                                if (type.count > 0) {
                                    Object.keys(type.split).forEach(themeKey => {
                                        const themeCount = type.split[themeKey];
                                        const themeLabel = themeKey.charAt(0).toUpperCase() + themeKey.slice(1);

                                        for (let i = 0; i < themeCount; i++) {
                                            const date = new Date();
                                            date.setDate(date.getDate() + dayOffset);

                                            this.workflow.generatedItems.push({
                                                id: itemId++,
                                                date: date.toISOString().split('T')[0],
                                                time: '14:00',
                                                type: typeLabels[typeKey],
                                                theme: themeLabel,
                                                lang: this.workflow.primaryLanguage,
                                                caption: `${themeLabel} ${typeLabels[typeKey]} for ${this.workflow.name}. ${data.data?.content_plan ? 'AI-optimized content based on your strategy.' : 'This is AI-generated content optimized for engagement.'}`,
                                                status: 'draft'
                                            });

                                            dayOffset++;
                                        }
                                    });
                                }
                            });

                            this.activeView = 'calendar';
                        })
                        .catch(error => {
                            console.error('Error configuring post mix:', error);

                            // Fallback to original behavior
                            this.workflow.generatedItems = [];
                            let itemId = Date.now();
                            let dayOffset = 0;

                            const typeLabels = {
                                image: 'Image Post',
                                carousel: 'Carousel',
                                video: 'Video',
                                poll: 'Poll',
                                story: 'Story',
                                link: 'Link Post'
                            };

                            Object.keys(this.workflow.types).forEach(typeKey => {
                                const type = this.workflow.types[typeKey];
                                if (type.count > 0) {
                                    Object.keys(type.split).forEach(themeKey => {
                                        const themeCount = type.split[themeKey];
                                        const themeLabel = themeKey.charAt(0).toUpperCase() + themeKey.slice(1);

                                        for (let i = 0; i < themeCount; i++) {
                                            const date = new Date();
                                            date.setDate(date.getDate() + dayOffset);

                                            this.workflow.generatedItems.push({
                                                id: itemId++,
                                                date: date.toISOString().split('T')[0],
                                                time: '14:00',
                                                type: typeLabels[typeKey],
                                                theme: themeLabel,
                                                lang: this.workflow.primaryLanguage,
                                                caption: `${themeLabel} ${typeLabels[typeKey]} for ${this.workflow.name}. This is AI-generated content optimized for engagement.`,
                                                status: 'draft'
                                            });

                                            dayOffset++;
                                        }
                                    });
                                }
                            });

                            this.activeView = 'calendar';
                        })
                        .finally(() => {
                            this.isGenerating = false;
                        });
                },

                backToWorkflow() {
                    this.activeView = 'workflow';
                },

                getItemsForDay(day) {
                    return this.workflow.generatedItems.filter(item => {
                        const itemDay = new Date(item.date).getDate();
                        return itemDay === day;
                    });
                },

                openPostEditor(itemId) {
                    this.postEditor.currentId = itemId;
                    this.activeView = 'postEditor';
                },

                closePostEditor() {
                    this.activeView = 'calendar';
                },

                getSelectedPost() {
                    return this.workflow.generatedItems.find(item => item.id === this.postEditor.currentId);
                },

                savePost() {
                    alert('Post saved successfully!');
                },

                schedulePost() {
                    const post = this.getSelectedPost();
                    if (post) {
                        post.status = 'scheduled';
                        alert('Post scheduled successfully!');
                    }
                },

                regeneratePost() {
                    const post = this.getSelectedPost();
                    if (!post) return;

                    // Show loading state
                    this.isGenerating = true;

                    // Prepare post update data for backend
                    const postUpdateData = {
                        post_id: post.id.toString(),
                        caption: post.caption,
                        hashtags: [],
                        scheduled_time: post.date + 'T' + post.time + ':00Z',
                        regenerate_content: true
                    };

                    // Call backend API to regenerate post content
                    fetch(`/api/v1/campaigns/${this.workflow.campaignId || 'temp-campaign-id'}/post`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(postUpdateData)
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.status === 'success') {
                                // Update post with AI-generated content
                                post.caption = `AI-Regenerated: ${post.theme} content for ${post.type}. ${data.data?.posts?.[post.id]?.caption || 'Fresh AI-generated caption with enhanced engagement potential optimized for your brand voice and campaign objectives.'}`;
                                alert('Post regenerated with AI!');
                            } else {
                                // Fallback to original behavior
                                post.caption = `Regenerated: ${Math.random().toString(36).substring(7)} - ${post.theme} content for ${post.type}. Fresh AI-generated caption with enhanced engagement potential.`;
                                alert('Post regenerated!');
                            }
                        })
                        .catch(error => {
                            console.error('Error regenerating post:', error);
                            // Fallback to original behavior
                            post.caption = `Regenerated: ${Math.random().toString(36).substring(7)} - ${post.theme} content for ${post.type}. Fresh AI-generated caption with enhanced engagement potential.`;
                            alert('Post regenerated!');
                        })
                        .finally(() => {
                            this.isGenerating = false;
                        });
                },

                enhancePost() {
                    const post = this.getSelectedPost();
                    if (post) {
                        post.caption += '\n\n‚ú® Enhanced with AI optimization for better engagement and reach.';
                        alert('Post enhanced!');
                    }
                },

                translateToAll() {
                    alert('Post translated to all languages!');
                },

                deletePost() {
                    if (confirm('Are you sure you want to delete this post?')) {
                        this.workflow.generatedItems = this.workflow.generatedItems.filter(
                            item => item.id !== this.postEditor.currentId
                        );
                        this.closePostEditor();
                    }
                },

                deletePostFromCalendar(itemId) {
                    if (confirm('Are you sure you want to delete this post?')) {
                        this.workflow.generatedItems = this.workflow.generatedItems.filter(
                            item => item.id !== itemId
                        );
                    }
                },

                movePost(itemId) {
                    const post = this.workflow.generatedItems.find(item => item.id === itemId);
                    if (!post) return;

                    const newDate = prompt('Enter new date (YYYY-MM-DD):', post.date);
                    if (newDate && /^\d{4}-\d{2}-\d{2}$/.test(newDate)) {
                        const newTime = prompt('Enter new time (HH:MM):', post.time);
                        if (newTime && /^\d{2}:\d{2}$/.test(newTime)) {
                            post.date = newDate;
                            post.time = newTime;
                            alert('Post moved successfully!');
                        } else if (newTime !== null) {
                            alert('Invalid time format. Please use HH:MM format.');
                        }
                    } else if (newDate !== null) {
                        alert('Invalid date format. Please use YYYY-MM-DD format.');
                    }
                },

                regenerateImage() {
                    if (confirm('Generate a new AI image for this post?')) {
                        alert('üé® Generating new image with AI... This may take a few moments.\n\nThe image will be optimized based on your post content and brand guidelines.');
                    }
                },

                addPersona() {
                    const name = prompt('Enter persona name:');
                    if (name) {
                        this.personas.push({
                            id: Date.now(),
                            name: name,
                            type: 'Custom',
                            summary: 'New persona'
                        });
                    }
                },

                addBrand() {
                    const name = prompt('Enter brand name:');
                    if (name) {
                        this.brands.push({
                            id: Date.now(),
                            name: name,
                            description: 'New brand',
                            voice: 'Professional'
                        });
                    }
                }
            }
        }
    </script>
</body>

</html>